<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap">
    <link rel="stylesheet" href="style.css">
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="app" v-cloak>
      <select v-model="configUrl">
        <option v-for="config in appConfig.configSet"
                :value="config.url">{{config.title}}</option>
      </select>
      <div v-if="configUrl">
        <input type="text" style="font-size:1.5rem;"
               v-model="config.title" placeholder="Enter title here" />
        <div style="margin:8px;">
          <div style="margin-bottom:4px;white-space:nowrap;">
            <label @mousedown.prevent><input type="checkbox"
              v-model="config.showPaperBox" />Show Paper Box</label>
            <label @mousedown.prevent><input type="checkbox"
              v-model="config.showBgBox" />Show Bg Box(Artboard)</label>
            <label @mousedown.prevent><input type="checkbox"
              v-model="config.rotate" />Rotate</label>
          </div>
          <div style="margin-bottom:4px;white-space:nowrap;">
            <label>ErrorCorrectionLevel:<select v-model="config.ecl">
              <option v-for="ecl in eclSet" :value="ecl.value">{{ecl.label}}</option>
              </select></label>
            <label>Zoom:<select v-model="config.zoom">
              <option v-for="zoom in zoomSet" :value="zoom.value">{{zoom.label}}</option>
              </select></label>
          </div>
          <div style="float:left;margin-right:8px;">
            <slider label="Margin Left(Paper)" :min="0" :max="40" v-model="config.marginLeft"></slider>
            <br/><slider label="Margin Right(Paper)" :min="0" :max="40" v-model="config.marginRight"></slider>
            <br/><slider label="Margin Top(Paper)" :min="0" :max="40" v-model="config.marginTop"></slider>
            <br/><slider label="Margin Bottom(Paper)" :min="0" :max="40" v-model="config.marginBottom"></slider>
            <br/><slider label="Horizontal Gap" :min="0" :max="40" v-model="config.hGap"></slider>
            <br/><slider label="Vertical Gap" :min="0" :max="40" v-model="config.vGap"></slider>
            <br/><slider label="QR Size" :min="10" :max="60" v-model="config.qrSize"></slider>
            <template v-for="(v, i) in config.qrMarginLeft" v-if="bgSVG">
              <br/><slider :label="'Margin Left#' + (i + 1) + '(QR)'"
                           :min="0" :max="40" v-model="config.qrMarginLeft[i].coarse"></slider>
              <br/><slider label=" Fine"
                           :min="-10" :max="10" v-model="config.qrMarginLeft[i].fine"></slider>
            </template>
            <template v-if="config.qrMarginTop">
              <br/><slider label="Margin Top(QR)"
                           :min="0" :max="40" v-model="config.qrMarginTop.coarse"></slider>
              <br/><slider label=" Fine"
                           :min="-10" :max="10" v-model="config.qrMarginTop.fine"></slider>
            </template>                               
          </div>
          <div style="float:left;">
            <div>copy back to assets/config.json</div>
            <textarea style="width:18rem;height:9rem;"
                      :readonly="true" :value="JSON.stringify(config,null,2)">
            </textarea>
          </div>
          <br style="clear:both;" />
        </div>
        <div>{{strings.length}} stickers / {{sheets.length}} sheets</div>
        <div v-for="(sheet, i) in sheets" class="stickers-sheet">
          <resizable-border v-if="i == 0" enable="r rb b"
            @resizestart="resizestartHandler"
            @resizemove="resizemoveHandler"></resizable-border>
          <span class="sheet-id">{{sheet.id}}</span>
          <button class="dl-button" @click="download_clickHandler(i, sheet.id)">Download SVG</button>
          <div :style="frameStyle" @mousedown="frame_mousedownHandler">
            <div ref="svgHolder" :style="svgHolderStyle">
              <svg ref="svg" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
                   :width="mm2pixel(config.paperWidth) + 'px'"
                   :height="mm2pixel(config.paperHeight) + 'px'"
                   :view-box.camel="'0 0 ' + config.paperWidth + ' ' + config.paperHeight" >
                <rect v-if="config.showPaperBox" fill="none" stroke="black"
                      stroke-width="0.5"
                      :width="config.paperWidth" :height="config.paperHeight" />
                <g v-for="sticker in sheet.stickers"
                   :transform="stickerTransform(sticker)">
                  <!-- background image -->
                  <x-svg :width="stickerWidth" :height="stickerHeight"
                         :svg="bgSVG" @load="svg_loadHandler"></x-svg>
                  <!-- background rect -->
                  <rect v-if="config.showBgBox" :width="stickerWidth" :height="stickerHeight"
                        fill="none" stroke="black" stroke-width="0.5" />
                  <!-- qrcode -->
                  <qrcode v-for="qr in sticker.qrs" :data="qr.data" :x="qr.x" :y="qr.y"
                          :size="config.qrSize" :pixels="config.pixels"
                          :type-number="config.typeNumber"
                          :error-correction-level="config.ecl" ></qrcode>
                </g>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br style="clear:both;" />
    <div style="height:200px;"></div>
    <script src="components.js"></script>
    <script src="sketch.js"></script>
  </body>
</html>
